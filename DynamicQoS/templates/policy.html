{% extends 'base2.html'%}
{% block content%}
{% load staticfiles %}
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="#">Policy Details</a>
        </li>
    </ol>

    <div class="row">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
              <i class="fa fa-folder-open"></i> Recent Policies</div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    {% for policy in policies %}
                    <li class="list-group-item">
                            <div>
                                <i class="fa fa-th-list">
                                </i> <h5 style="display: inline-block">{{ policy.name }}</h5>

                                <span class="pull-right">
                                     <a class="mr-3 d-inline-block pull-right" data-id="{{ policy.id }}" href="#" ><i class="fa fa-trash" data-toggle="modal" data-target="#kt_modal_3" ></i></a>
                                    {% if policy.enable  %}
                                    <a class="mr-3 d-inline-block pull-right activated-policy" onclick="activePolicy('{{ policy.id }}')" id="{{ policy.id }}" >

                                        <i class="fa fa-toggle-on policy-on"></i> <i class="fa fa-toggle-off policy-off"></i>
                                    </a>
                                    {% else %}
                                    <a class="mr-3 d-inline-block pull-right disactivated-policy" onclick="activePolicy('{{ policy.id }}')" id="{{ policy.id }}">

                                        <i class="fa fa-toggle-off policy-off"></i> <i class="fa fa-toggle-on policy-on"></i>
                                    </a>
                                    {% endif %}


                                    <a class="mr-3 d-inline-block pull-right" href="{% url 'policy_dashboard' policy.id%} " ><i class="fa fa-stream"></i></a>
                                </span>
                            </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            <a  class="card-footer clearfix small z-1" href="#">
              <span class="float-left">View all</span>
              <span class="float-right">
                <i class="fa fa-angle-right"></i>
              </span>
            </a>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
              <i class="fa fa-plus"></i> New policy</div>
            <div class="card-body">
                <form method="POST" action="{% url 'policies' %}">
                    {% csrf_token %}
                    <div class="form-group">
                    <div class="col-md-8">
                        <label for="exampleInputName">policy name:</label>
                        {{ policy_form.name }}
                        {% if error %}
                        <p style="color : red">{{ error }}</p>
                        {% endif %}
                    </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-8">
                            <label for="exampleInputLastName">Description:</label>
                            {{ policy_form.description}}
                        </div>
                    </div>
                <div class="form-group">
                        <div class="col-md-8">
                            <label for="exampleInputLastName">Topology:</label>
                            {{ policy_form.topologies}}
                        </div>

                    <div class="form-group">
                        <div class="col-md-8">
                            <button type="submit" class="btn btn-primary btn-block" >Add</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    </div>
     <div class="modal fade" id="kt_modal_3" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" style="display: none;" aria-hidden="true">
								<div class="modal-dialog" role="document">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title" id="exampleModalLabel">Confirm Deletion</h5>
											<button type="button" class="close" data-dismiss="modal" aria-label="Close">
											</button>
										</div>
										<div class="modal-body">
                                            <p>Are you sure you want to delete the Policy ?</p>

											</div>
										<div class="modal-footer">
											<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
											<button type="button" class="btn btn-danger">Delete</button>
										</div>
									</div>
								</div>
							</div>



{%endblock%}
{% block scripts %}
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

    <script>

    $('.activated-policy .policy-off').css('display' , 'none');
    $('.disactivated-policy .policy-on').css('display' , 'none');
    function activePolicy(idPolicy) {
        console.log('activing policy ....');
        $.get('/policy_on/' + idPolicy , function (result, status) {
            console.log(result , status);
                console.log($('#' + idPolicy + ' .policy-off'));
                $('.policy-off').css('display' , 'block');
                $('.policy-on').css('display' , 'none');
                $('#' + idPolicy + ' .policy-off').css('display' , 'none');
                $('#' + idPolicy + ' .policy-on').css('display' , 'block');

        })
    }


    </script>
{%  endblock %}
