{% extends 'base2.html'%}
{% block content%}
    <div class="modal fade" id="kt_modal_4" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" style="display: none;" aria-hidden="true">
								<div class="modal-dialog modal-lg" role="document">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title" id="exampleModalLabel">Edit</h5>
											<button type="button" class="close" data-dismiss="modal" aria-label="Close">
											</button>
										</div>
										<div class="modal-body">
										 <form id="form1" role="form">

                        <div class="form-group">
                            <label for="hostname"><span class="glyphicon glyphicon-file"></span> Hostname</label>
                            <input type="text" name="hostname" id="hostname">
                        </div>
                        <input type="hidden" id="type" name="type" value="">
                        <button type="submit" class="btn btn-success btn-block" ><span
                                class="glyphicon glyphicon-ok" ></span> OK
                        </button>
                    </form>
										</div>
									</div>
								</div>
							</div>
    <div class="modal fade" id="kt_modal_3" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" style="display: none;" aria-hidden="true">
								<div class="modal-dialog" role="document">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title" id="exampleModalLabel">Confirm Deletion</h5>
											<button type="button" class="close" data-dismiss="modal" aria-label="Close">
											</button>
										</div>
										<div class="modal-body">
                                            <p>Are you sure you?</p>

											</div>
										<div class="modal-footer">
											<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
											<button type="button" class="btn btn-danger" data-dismiss="modal" id="delete">Delete</button>
										</div>
									</div>
								</div>
							</div>
<div class="kt-portlet kt-portlet--mobile">
        <div class="kt-portlet__head kt-portlet__head--lg">
            <div class="kt-portlet__head-label">
                <span class="kt-portlet__head-icon">
                    <i class="kt-font-brand flaticon2-line-chart"></i>
                </span>
                <h3 class="kt-portlet__head-title">
                    Devices Table
                </h3>

            </div>
{#            <div class="kt-portlet__head-toolbar">#}
{#                <div class="kt-portlet__head-wrapper">#}
{#                    <div class="kt-portlet__head-actions">#}
{#                        <select class="costum-select" id="topoSelect">#}
{#                            <option value="" disabled selected>Select a topologie</option>#}
{#                        </select>#}
{##}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
        </div>
        <div class="kt-portlet__body">

            <table id="example" class="table table-striped table-bordered" style="width:100%">
                <thead>
                <tr>
                    <th>Device id</th>
                    <th>Device Name</th>
                    <th>username</th>
                    <th>password</th>
                    <th>address</th>
                    <th>enable secret</th>
                    <th style='width:15%' >Action</th>
                </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script>
        var url1 = 'http://localhost:8000/api/v1/devices?topology_id={{ topology_id }}';
        var periodUrl = '';
        var table;
        var periodTable;
        var periodTopo = '';
        var startPeriod = '';
        var endPeriod = '';
        $(document).ready(function () {
            table = $('#example').DataTable({
                ajax: {
      url: url1,
      dataSrc: ""
    },
    columns: [
        { "data": "id" },
        { "data": "hostname" },
        { "data": "device_username"},
        { "data": "device_password"},
        { "data": "device_address"},
        { "data": "device_enable"},
         {
            "data": null,
            "defaultContent": '<button type="button" class="btn btn-sm btn-info" data-toggle="modal" data-target="#kt_modal_4" >Edit</button>' + '&nbsp;&nbsp' +
            '<button type="button" class="btn btn-sm btn-danger" data-toggle="modal" data-target="#kt_modal_3">Delete</button>'
        }
    ]
            });

            url1 = 'http://localhost:8000/api/v1/devices?topology_id={{ topology_id }}';
            table.ajax.url(url1).load();
            reloadDataTable();
        });
let id = 0;
        $('#example tbody').on('click', 'button', function () {
    let data = table.row($(this).parents('tr')).data();
    let class_name = $(this).attr('class');
    if (class_name === 'btn btn-sm btn-info') {
        // EDIT button
        $('#hostname').val(data['hostname']);
        $('#type').val('edit');
        $('#modal_title').text('EDIT');
        $("#myModal").modal();
    } else {
        // DELETE button
        $('#modal_title').text('DELETE');
        $("#confirm").modal();
    }
       id = data['id'];

});
        $('#form1').on('submit', function (e) {
    e.preventDefault();
    let $this = $(this);
    let type = $('#type').val();
    let method = '';
    let url = 'http://localhost:8000/api/v1/devices/';
    if (type == 'new') {
        // new
        method = 'POST';
    } else {
        // edit
        url = url + id + '/';
        method = 'PUT';
    }

    $.ajax({
        url: url,
        method: method,
        data: $this.serialize(),
        success: function(data, textStatus, jqXHR) {
         table.ajax.url(url1).load();
         reloadDataTable();
         $('#kt_modal_4').modal('hide');
         $('.modal-backdrop').remove();
    }
    })
});


        $('#kt_modal_3').on('click', '#delete', function (e) {
    $.ajax({
        url: 'http://localhost:8000/api/v1/devices/' + id + '/',
        method: 'DELETE',
        success: function(data, textStatus, jqXHR) {
         table.ajax.url(url1).load();
         reloadDataTable();
    }
    })
});

        function reloadDataTable() {
            setInterval(function () {
                table.ajax.reload();
            }, 5000);
        }



    </script>


{%endblock%}
